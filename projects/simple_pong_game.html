<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mario 64 Inspired Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #000;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="1200" height="800"></canvas>
  <script>
    /*  
     * Mario 64 Inspired Platformer
     * ----------------------------------------
     * This simple game has two states:
     *   1. Menu — lets you pick one of six levels.
     *   2. Play — you control the "player" (a rectangle) who can run and jump.
     * When reaching the goal block the game shows a win screen.
     *
     * Controls: Arrow keys for left/right motion; ArrowUp or Space for jump.
     *
     * Levels (each inspired by a Mario 64 stage):
     *   1. Castle Courtyard
     *   2. Cool, Cool Mountain
     *   3. Bowser's Fortress
     *   4. Lethal Lava Land
     *   5. Tiny-Huge Island
     *   6. Tick-Tock Clock
     *
     * Each level has its own background color, platform layout, and a goal location.
     */

    // Get canvas context
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const CANVAS_WIDTH = canvas.width;
    const CANVAS_HEIGHT = canvas.height;

    // Define our levels
    const levels = [
      {
        name: "Castle Courtyard",
        bgColor: "#87CEEB", // sky blue
        playerStart: { x: 100, y: 600 },
        platforms: [
          { x: 0,   y: 680, w: 1200, h: 120 },  // ground
          { x: 500, y: 550, w: 200,  h: 20 }
        ],
        goal: { x: 1080, y: 600, w: 80, h: 80 }  // goal block (e.g. a star or coin)
      },
      {
        name: "Cool, Cool Mountain",
        bgColor: "#B0E0E6", // powder blue
        playerStart: { x: 50, y: 600 },
        platforms: [
          { x: 0,   y: 680, w: 1200, h: 120 },
          { x: 200, y: 550, w: 150,  h: 20 },
          { x: 400, y: 450, w: 150,  h: 20 },
          { x: 600, y: 350, w: 150,  h: 20 },
          { x: 800, y: 250, w: 150,  h: 20 }
        ],
        goal: { x: 950, y: 200, w: 50, h: 50 }
      },
      {
        name: "Bowser's Fortress",
        bgColor: "#8B0000", // dark red
        playerStart: { x: 50, y: 600 },
        platforms: [
          { x: 0,   y: 680, w: 1200, h: 120 },
          { x: 200, y: 550, w: 200,  h: 20 },
          { x: 500, y: 500, w: 200,  h: 20 },
          { x: 800, y: 450, w: 200,  h: 20 }
        ],
        goal: { x: 1000, y: 400, w: 60, h: 60 }
      },
      {
        name: "Lethal Lava Land",
        bgColor: "#FFA500", // orange
        playerStart: { x: 50, y: 600 },
        platforms: [
          { x: 0,   y: 680, w: 1200, h: 120 },
          { x: 300, y: 600, w: 150,  h: 20 },
          { x: 600, y: 520, w: 200,  h: 20 },
          { x: 900, y: 440, w: 150,  h: 20 }
        ],
        goal: { x: 1050, y: 400, w: 50, h: 50 }
      },
      {
        name: "Tiny-Huge Island",
        bgColor: "#90EE90", // light green
        playerStart: { x: 50, y: 600 },
        platforms: [
          { x: 0,   y: 680, w: 1200, h: 120 },
          { x: 250, y: 600, w: 100,  h: 20 },
          { x: 400, y: 550, w: 200,  h: 20 },
          { x: 700, y: 500, w: 120,  h: 20 },
          { x: 900, y: 450, w: 150,  h: 20 }
        ],
        goal: { x: 1050, y: 400, w: 50, h: 50 }
      },
      {
        name: "Tick-Tock Clock",
        bgColor: "#708090", // slate gray
        playerStart: { x: 50, y: 600 },
        platforms: [
          { x: 0,   y: 680, w: 1200, h: 120 },
          { x: 150, y: 550, w: 100,  h: 20 },
          { x: 300, y: 500, w: 100,  h: 20 },
          { x: 450, y: 450, w: 100,  h: 20 },
          { x: 600, y: 400, w: 100,  h: 20 },
          { x: 750, y: 350, w: 100,  h: 20 },
          { x: 900, y: 300, w: 100,  h: 20 }
        ],
        goal: { x: 1050, y: 250, w: 50, h: 50 }
      }
    ];

    // ----- Global Game Variables -----
    let gameState = "menu";   // "menu", "play", or "win"
    let currentLevelIndex = null;
    let currentLevel = null;
    let player = null;
    let keys = {};

    const GRAVITY = 2500; // pixels per second squared

    // ----- Player Object Setup -----
    function startLevel(index) {
      currentLevelIndex = index;
      currentLevel = levels[index];
      // Create a simple player
      player = {
        x: currentLevel.playerStart.x,
        y: currentLevel.playerStart.y,
        width: 50,
        height: 50,
        vx: 0,
        vy: 0,
        speed: 300,     // horizontal speed (px/s)
        jumpPower: -800, // initial jump velocity (px/s, negative = up)
        onGround: false
      };
      gameState = "play";
    }

    function goToMenu() {
      gameState = "menu";
      currentLevel = null;
      currentLevelIndex = null;
      player = null;
    }

    // ----- Input Handlers -----
    window.addEventListener("keydown", function (e) {
      keys[e.code] = true;
    });
    window.addEventListener("keyup", function (e) {
      keys[e.code] = false;
    });

    // ----- Menu and Mouse Clicks -----
    canvas.addEventListener("click", function (e) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;
      
      if (gameState === "menu") {
        // Draw menu items from y = 200 downward,
        // with each level having a 50px high region.
        const startY = 200;
        const spacing = 50;
        for (let i = 0; i < levels.length; i++) {
          let itemY = startY + i * spacing;
          // We assume the text occupies about 40 pixels in height.
          if (mouseY >= itemY - 30 && mouseY <= itemY) {
            startLevel(i);
            break;
          }
        }
      } else if (gameState === "win") {
        // Click returns to menu.
        goToMenu();
      }
    });

    // ----- Collision Detection -----
    // Check if two rectangles intersect.
    function rectIntersect(r1, r2) {
      return !(r2.x > r1.x + r1.w ||
               r2.x + r2.w < r1.x ||
               r2.y > r1.y + r1.h ||
               r2.y + r2.h < r1.y);
    }

    // ----- Game Update and Physics -----
    function update(dt) {
      if (gameState !== "play") return;
      
      // Horizontal movement.
      if (keys["ArrowLeft"]) {
        player.vx = -player.speed;
      } else if (keys["ArrowRight"]) {
        player.vx = player.speed;
      } else {
        player.vx = 0;
      }
      // Jump if on ground.
      if ((keys["ArrowUp"] || keys["Space"]) && player.onGround) {
        player.vy = player.jumpPower;
        player.onGround = false;
      }

      // Apply physics
      player.x += player.vx * dt;
      player.y += player.vy * dt;
      player.vy += GRAVITY * dt;

      // Simple collision: check each platform in the current level.
      player.onGround = false;
      for (let plat of currentLevel.platforms) {
        const pRect = { x: plat.x, y: plat.y, w: plat.w, h: plat.h };
        const playerRect = { x: player.x, y: player.y, w: player.width, h: player.height };

        if (rectIntersect(playerRect, pRect)) {
          // Only resolve vertical collisions from above.
          // If the bottom of the player was above the platform in the previous frame, then land.
          if (player.vy >= 0 && (player.y + player.height - player.vy * dt) <= plat.y + 5) {
            player.y = plat.y - player.height;
            player.vy = 0;
            player.onGround = true;
          }
        }
      }

      // If the player falls off the bottom of the canvas, restart level.
      if (player.y > CANVAS_HEIGHT) {
        startLevel(currentLevelIndex);
      }

      // Check for reaching the goal.
      const goalRect = currentLevel.goal;
      const playerRect = { x: player.x, y: player.y, w: player.width, h: player.height };
      if (rectIntersect(playerRect, goalRect)) {
        gameState = "win";
      }
    }

    // ----- Drawing Functions -----
    function drawMenu() {
      ctx.fillStyle = "#000"; 
      ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
      ctx.fillStyle = "#FFF";
      ctx.font = "40px Arial";
      ctx.textAlign = "center";
      ctx.fillText("Mario 64 Inspired Platformer", CANVAS_WIDTH / 2, 100);
      
      // List each level.
      ctx.font = "30px Arial";
      const startY = 200;
      const spacing = 50;
      for (let i = 0; i < levels.length; i++) {
        let itemY = startY + i * spacing;
        ctx.fillStyle = "#FFD700";
        ctx.fillText((i+1) + ". " + levels[i].name, CANVAS_WIDTH / 2, itemY);
      }
      ctx.font = "20px Arial";
      ctx.fillStyle = "#FFF";
      ctx.fillText("Click on a level to play", CANVAS_WIDTH / 2, startY + levels.length * spacing + 40);
    }

    function drawPlay() {
      // Draw background
      ctx.fillStyle = currentLevel.bgColor;
      ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

      // Draw platforms
      for (let plat of currentLevel.platforms) {
        ctx.fillStyle = "#444";
        ctx.fillRect(plat.x, plat.y, plat.w, plat.h);
      }

      // Draw goal block (for example, a golden block)
      const goal = currentLevel.goal;
      ctx.fillStyle = "#FFD700";
      ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

      // Draw the player
      ctx.fillStyle = "#FF0000";  // Mario’s signature red (this is a placeholder!)
      ctx.fillRect(player.x, player.y, player.width, player.height);

      // Show level name at top-left.
      ctx.fillStyle = "#000";
      ctx.font = "24px Arial";
      ctx.fillText(currentLevel.name, 20, 40);
    }

    function drawWin() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
      ctx.fillStyle = "#0F0";
      ctx.font = "50px Arial";
      ctx.textAlign = "center";
      ctx.fillText("You Reached The Goal!", CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
      ctx.font = "30px Arial";
      ctx.fillText("Click to return to the menu", CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + 50);
    }

    // Main drawing function
    function draw() {
      if (gameState === "menu")
        drawMenu();
      else if (gameState === "play")
        drawPlay();
      else if (gameState === "win")
        drawWin();
    }

    // ----- Main Game Loop -----
    let lastTime = performance.now();
    function gameLoop(currentTime) {
      let dt = (currentTime - lastTime) / 1000;
      lastTime = currentTime;
      
      if (gameState === "play") {
        update(dt);
      }
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Start in the menu.
    goToMenu();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
