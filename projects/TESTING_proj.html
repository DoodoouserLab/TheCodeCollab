<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reach the Target - Simple Three.js Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: sans-serif;
    }
    canvas {
      display: block;
    }
    /* Overlay for instructions and messages */
    #overlay {
      position: absolute;
      width: 100%;
      top: 0;
      color: white;
      text-align: center;
      z-index: 10;
      pointer-events: none;
    }
    #instructions {
      font-size: 1em;
      margin-top: 10px;
    }
    #message {
      font-size: 2em;
      margin-top: 20px;
    }
  </style>
  <!-- Load Three.js and PointerLockControls from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/PointerLockControls.js"></script>
</head>
<body>
  <div id="overlay">
    <div id="instructions">
      Click anywhere to start. Use WASD to move and mouse to look.<br>
      Goal: Reach the glowing cube!
    </div>
    <div id="message"></div>
  </div>
  <script>
    // --- Scene, Camera, Renderer ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB); // Sky blue

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    
    // --- Add a Ground Plane ---
    const groundGeometry = new THREE.PlaneGeometry(200, 200);
    const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);
    
    // --- Create the Target Cube ---
    // We'll use an emissive material so it appears to glow
    const targetGeometry = new THREE.BoxGeometry(1, 1, 1);
    const targetMaterial = new THREE.MeshLambertMaterial({ color: 0xffd700, emissive: 0xffd700 });
    const goalCube = new THREE.Mesh(targetGeometry, targetMaterial);
    // Position the goal cube at a specific location (for example, near the edge of the ground)
    goalCube.position.set(20, 1, -20);
    scene.add(goalCube);
    
    // --- Lighting ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(50, 100, 50);
    scene.add(directionalLight);
    
    // --- PointerLockControls Setup ---
    const controls = new THREE.PointerLockControls(camera, document.body);
    scene.add(controls.getObject());
    
    // When you click on the page, lock the pointer:
    document.addEventListener("click", () => {
      controls.lock();
    }, false);
    
    document.addEventListener("pointerlockchange", () => {
      if (document.pointerLockElement !== document.body) {
        document.getElementById("instructions").style.display = "";
      } else {
        document.getElementById("instructions").style.display = "none";
      }
    });
    
    // --- Player Movement Variables ---
    let moveForward = false,
        moveBackward = false,
        moveLeft = false,
        moveRight = false;
    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const clock = new THREE.Clock();
    
    // --- Event Listeners for Movement ---
    document.addEventListener("keydown", function(e) {
      switch(e.code) {
        case "KeyW": moveForward = true; break;
        case "KeyS": moveBackward = true; break;
        case "KeyA": moveLeft = true; break;
        case "KeyD": moveRight = true; break;
      }
    });
    document.addEventListener("keyup", function(e) {
      switch(e.code) {
        case "KeyW": moveForward = false; break;
        case "KeyS": moveBackward = false; break;
        case "KeyA": moveLeft = false; break;
        case "KeyD": moveRight = false; break;
      }
    });
    
    // --- Set an initial camera/player height ---
    controls.getObject().position.y = 2;
    
    // --- Game State ---
    let gameWon = false;
    const messageDiv = document.getElementById("message");
    
    // --- Animation Loop ---
    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();
      
      if (controls.isLocked === true) {
        // Update velocity based on movement state.
        velocity.x -= velocity.x * 10.0 * delta;
        velocity.z -= velocity.z * 10.0 * delta;
        
        direction.z = Number(moveForward) - Number(moveBackward);
        direction.x = Number(moveRight) - Number(moveLeft);
        direction.normalize();
        
        if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
        if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;
        
        // Move the controls (first-person)
        controls.moveRight(- velocity.x * delta);
        controls.moveForward(- velocity.z * delta);
      }
      
      // Check win condition: if player is within 2 units of the goal cube.
      if (!gameWon) {
        const playerPos = controls.getObject().position;
        const dist = playerPos.distanceTo(goalCube.position);
        if (dist < 2) {
          gameWon = true;
          messageDiv.textContent = "You Win!";
        }
      }
      
      renderer.render(scene, camera);
    }
    
    animate();
    
    // --- Handle Window Resize ---
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
    
  </script>
</body>
</html>
